<!DOCTYPE html>
<html>

<head>
    <!-- Page Title -->
    <meta charset="UTF-8" />
    <title id="Title">Survey Results | Robotics Scouting Site</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Page Icon -->
    <link rel="shortcut icon" href="/items/4079-transparent.png" type="image/x-icon">

    <!-- Libaries -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- External CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Yeon+Sung&display=swap">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">

    <!-- External JS -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js-css/js/ScoutingData.js"></script>

    <!-- Internal CSS -->
    <link rel="stylesheet" href="/js-css/css/surveyresults.css">

</head>

<body onload="setUp(document.getElementById('searchType').value)">
    <div id="leftHalf"></div>
    <div id="rightHalf"></div>

    <center>

        <div id="search">
            <label for="searchInput">Find Teams</label>
            <input id="searchInput" type="text" placeholder="4079" min="1" max="99999" inputmode="numeric"
                type="number">

            <select id="searchType" onchange="setUp(document.getElementById('searchType').value);">
                <option value="All-Scouting">All Teams</option>
                <option value="Pit-Scouting">Pit Scouting</option>
                <option value="Match-Scouting">Match Scouting</option>
            </select>

            <button onclick="window.location='/'" id="Back">Go Back</button>

        </div>

        <div class="container" id="Teams">

        </div>
    </center>

    <script>
        let container = document.getElementsByClassName("container")[0];
        let searchInput = document.getElementById("searchInput");

        searchInput.addEventListener("input", function () {
            // Clear existing boxes
            container.innerHTML = '';

            // Filter ScoutingData based on search input
            let filteredData = ScoutingData.filter(data => data[0].toString().includes(searchInput.value));

            // Sort filtered data in descending order
            filteredData.sort((a, b) => b[0] - a[0]);


            // Create new boxes based on filtered data
            for (let i = 0; i < filteredData.length; i++) {

                var TeamName;

                if (filteredData[i].length === 13) {
                    let Matches = {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            'TeamNumber': filteredData[i][0],
                            'Event': filteredData[i][11]
                        })
                    }

                    fetch('/matches', Matches)
                        .then(response => response.json())
                        .then(data => {
                            TeamName = data;
                            Create();
                        });
                } else if (filteredData[i].length === 15) {
                    let Matches = {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            'TeamNumber': filteredData[i][0],
                            'Event': filteredData[i][13]
                        })
                    }

                    fetch('/matches', Matches)
                        .then(response => response.json())
                        .then(data => {
                            TeamName = data;
                            Create();
                        });
                }

                function Create() {
                    //console.log("Debugging")

                    let box = document.createElement("div");
                    box.className = "box";
                    box.id = "box" + i;
                    container.appendChild(box);

                    let h1TeamNumber = document.createElement("h1");
                    h1TeamNumber.innerHTML = "Team " + filteredData[i][0] + " - " + TeamName.TeamNames;
                    box.appendChild(h1TeamNumber);

                    let h2Summary = document.createElement("h2");
                    let Scouting;
                    if (filteredData[i].length === 13) {
                        Scouting = "Pit Scouting at " + filteredData[i][11] + " at " + filteredData[i][12]
                    } else if (filteredData[i].length === 15) {
                        Scouting = "Match Scouting at " + filteredData[i][13] + " at " + filteredData[i][14];
                    }
                    h2Summary.innerHTML = Scouting;
                    box.appendChild(h2Summary);

                    // Create the button
                    let button = document.createElement("button");
                    button.id = "button" + i;
                    button.onclick = function () {
                        if (document.getElementById("data" + i).style.display === "none") {
                            document.getElementById("data" + i).style.display = "block";
                        } else {
                            document.getElementById("data" + i).style.display = "none";
                        }
                    };
                    box.appendChild(button);

                    // Append an anchor to the box
                    let a = document.createElement("a");
                    a.id = "a" + i;
                    a.innerHTML = "View Survey Results";
                    button.appendChild(a);

                    box.appendChild(document.createElement("br"));

                    let data = document.createElement("div");
                    data.id = "data" + i;
                    data.className = "data";
                    if (ScoutingData[i].length === 13) {
                        data.innerHTML = "Team Number: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][0] + "'><br>" +
                            "Game Pieces: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][1] + "'><br>" +
                            "Driver Experience: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][2] + "'><br>" +
                            "Drive Train: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][3] + "'><br>" +
                            "Auto Plan: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][4] + "'><br>" +
                            "Game Piece Pickup: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][5] + "'><br>" +
                            "Cycle Time (seconds): " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][6] + "'><br>" +
                            "Scoring Location: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][7] + "'><br>" +
                            "Docking and Engaging: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][8] + "'><br>" +
                            "Picture: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][9] + "'><br>" +
                            "Comments: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][10] + "'><br>" +
                            "Time: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][12] + "'><br>";
                    } else if (ScoutingData[i].length === 15) {
                        data.innerHTML = "Team Number: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][0] + "'><br>" +
                            "Match Number: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][1] + "'><br>" +
                            "Alliance Color: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][2] + "'><br>" +
                            "Leave Community: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][3] + "'><br>" +
                            "Auto Cube Scoring: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][4] + "'><br>" +
                            "Auto Cone Scoring: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][5] + "'><br>" +
                            "Auto Balance: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][6] + "'><br>" +
                            "Defensive Play: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][7] + "'><br>" +
                            "Teleop Cube Scoring: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][8] + "'><br>" +
                            "Teleop Cone Scoring: " + "<input class='datainput' oninput='runChange(this) 'type='text' value='" + ScoutingData[i][9] + "'><br>" +
                            "Cargo Location: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][10] + "'><br>" +
                            "Teleop Balance: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][11] + "'><br>" +
                            "Comments: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][12] + "'><br>" +
                            "Time: " + "<input class='datainput' oninput='runChange(this)' type='text' value='" + ScoutingData[i][14] + "'><br>";
                    }
                    data.style.display = "none";
                    box.appendChild(data);

                    box.appendChild(document.createElement("br"));

                }
            }
        });
    </script>
</body>

</html>